<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Swipe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/phosphor-icons"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent; /* Prevent flash on tap for mobile */
            overscroll-behavior-y: contain; /* Prevents pull-to-refresh on the body */
        }
        .app-bg { background-color: #f0f2f5; }
        .main-container {
            max-width: 420px;
            min-height: 100dvh; /* Use dynamic viewport height for better mobile browser support */
            max-height: 900px;
            display: flex;
            flex-direction: column;
            overscroll-behavior-y: contain;
        }
        
        /* --- Swipe Card Styles --- */
        #swipe-deck { perspective: 1000px; }
        .swipe-card-stack {
            display: grid;
            width: 100%;
            height: 100%;
            position: relative;
            align-items: center;
            justify-items: center;
        }
        .swipe-card {
            touch-action: none; /* Critical for smooth custom dragging */
            user-select: none;
            position: absolute;
            grid-column: 1 / -1;
            grid-row: 1 / -1;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            height: 100%; 
            width: 100%; 
            will-change: transform, opacity; /* Performance hint for the browser */
        }
        .swipe-card.dragging { transition: none; }
        .swipe-card-stack > :nth-child(2) {
            transform: translateY(12px) scale(0.95);
            filter: brightness(0.95);
            z-index: -1;
            transition: transform 0.4s ease-out, filter 0.4s ease-out;
        }
        .swipe-card-stack > :nth-child(3) {
            transform: translateY(24px) scale(0.90);
            filter: brightness(0.9);
            z-index: -2;
        }
        .swipe-card-stack > :nth-child(n+4) { display: none; }
        .like-nope-badge {
            transition: opacity 0.2s ease-in;
            will-change: opacity;
        }
        .swipe-card-image { height: 60%; }

        /* Match animation */
        @keyframes pop-in {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .match-animation { animation: pop-in 0.5s ease-out forwards; }

        /* Custom scrollbar for chat */
        .chat-messages::-webkit-scrollbar { width: 4px; }
        .chat-messages::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 20px;
        }
    </style>
</head>
<body class="app-bg flex justify-center items-center">

    <!-- Main App Container -->
    <div id="appContainer" class="main-container w-full h-full bg-white shadow-2xl rounded-lg overflow-hidden relative">

        <!-- ===== Screen 1: Post to Play ===== -->
        <div id="postScreen" class="flex flex-col items-center justify-center text-center h-full px-8 py-12 gap-12">
            <div>
                <div class="w-24 h-24 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl flex items-center justify-center mb-6 shadow-lg mx-auto">
                    <i class="ph-camera-plus" style="font-size: 48px; color: white;"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800">Post to Play</h1>
                <p class="text-gray-600 mt-2">Share a photo to see today's batch.</p>
            </div>
            
            <div class="bg-gray-100 p-6 rounded-2xl w-full">
                <p class="text-gray-500 text-sm mb-2">TODAY'S PROMPT</p>
                <p id="dailyPrompt" class="text-xl font-semibold text-gray-800">Your favorite study spot ðŸ“š</p>
            </div>

            <div>
                <button onclick="startSwiping()" class="w-full bg-indigo-600 text-white font-bold py-4 px-6 rounded-full text-lg shadow-md hover:bg-indigo-700 transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Post Today's Photo
                </button>
                <p class="text-xs text-gray-400 mt-4">Uses in-app camera only. No uploads!</p>
            </div>
        </div>

        <!-- ===== Screen 2: Swiping ===== -->
        <div id="swipeScreen" class="hidden flex-grow flex flex-col relative overflow-hidden bg-gray-50">
             <!-- Header -->
            <div class="flex justify-between items-center p-4 border-b border-gray-200 bg-white z-10">
                 <h1 class="text-2xl font-bold text-indigo-600">Daily Swipe</h1>
                 <button onclick="showScreen('chatsListScreen')" class="p-2 rounded-full hover:bg-gray-100">
                     <i class="ph-chats-teardrop" style="font-size: 28px; color: #4f46e5;"></i>
                 </button>
            </div>

            <!-- Main Swipe Area -->
            <div class="flex-grow w-full relative">
                <!-- Swipe Deck (where cards live) -->
                <div id="swipe-deck" class="absolute inset-x-4 top-4 bottom-32 flex items-center justify-center">
                    <!-- Placeholder for end of batch -->
                    <div id="endOfBatch" class="hidden text-center p-4">
                        <div class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4 mx-auto">
                            <i class="ph-timer" style="font-size: 40px; color: #6b7280;"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">That's everyone for today!</h2>
                        <p class="text-gray-500 mt-1">Check back tomorrow for a new batch.</p>
                    </div>
                    <!-- Card stack will be generated here -->
                </div>
                
                <!-- Action Buttons -->
                <div id="action-buttons" class="absolute bottom-6 inset-x-0 flex justify-center items-center gap-6 z-10">
                    <button onclick="handleSwipe('left')" class="w-20 h-20 rounded-full bg-white shadow-xl flex items-center justify-center text-red-500 hover:bg-red-50 transition-transform transform hover:scale-110 active:scale-100">
                        <i class="ph-x" style="font-size: 40px;"></i>
                    </button>
                    <button onclick="handleSwipe('right')" class="w-24 h-24 rounded-full bg-white shadow-xl flex items-center justify-center text-green-500 hover:bg-green-50 transition-transform transform hover:scale-110 active:scale-100">
                        <i class="ph-heart" style="font-size: 48px;"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ===== Screen 3: Chats List ===== -->
        <div id="chatsListScreen" class="hidden flex-grow flex flex-col">
            <!-- Header -->
            <div class="flex items-center p-4 border-b border-gray-200">
                 <button onclick="showScreen('swipeScreen')" class="p-2 mr-2 rounded-full hover:bg-gray-100">
                     <i class="ph-arrow-left" style="font-size: 24px; color: #4f46e5;"></i>
                 </button>
                 <h1 class="text-2xl font-bold text-indigo-600">Matches</h1>
            </div>
            <!-- Chat List -->
            <div id="chatListContainer" class="flex-grow overflow-y-auto p-2">
                <!-- Chat items will be injected here -->
            </div>
        </div>

        <!-- ===== Screen 4: Chat View ===== -->
        <div id="chatViewScreen" class="hidden flex-grow flex flex-col">
            <!-- Chat Header -->
            <div class="flex items-center p-3 border-b border-gray-200 bg-white">
                 <button onclick="showScreen('swipeScreen')" class="p-2 mr-2 rounded-full hover:bg-gray-100">
                     <i class="ph-arrow-left" style="font-size: 24px; color: #4f46e5;"></i>
                 </button>
                 <img id="chatPartnerAvatar" src="https://placehold.co/40x40/E2E8F0/4A5568?text=A" class="w-10 h-10 rounded-full mr-3 object-cover" loading="lazy" decoding="async">
                 <div>
                    <h2 id="chatPartnerName" class="font-bold text-lg text-gray-800"></h2>
                    <p class="text-sm text-gray-500">Active now</p>
                 </div>
            </div>
            <!-- Messages Area -->
            <div id="chatMessages" class="chat-messages flex-grow p-4 overflow-y-auto bg-gray-50">
                <!-- Messages will be injected here -->
            </div>
            <!-- Message Input -->
            <div class="p-3 bg-white border-t border-gray-200">
                <form id="messageForm" class="flex items-center bg-gray-100 rounded-full px-4 py-2">
                    <input id="messageInput" type="text" placeholder="Type a message..." class="flex-grow bg-transparent focus:outline-none text-gray-700">
                    <button type="submit" class="ml-2 p-2 rounded-full bg-indigo-600 text-white hover:bg-indigo-700 transition">
                        <i class="ph-paper-plane-tilt-fill" style="font-size: 20px;"></i>
                    </button>
                </form>
            </div>
        </div>

        <!-- ===== Pop-up: It's a Match! ===== -->
        <div id="matchPopup" class="hidden absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center p-8 z-50">
            <div class="match-animation bg-white p-8 rounded-3xl text-center shadow-2xl max-w-sm w-full">
                <h2 class="text-4xl font-bold bg-gradient-to-r from-indigo-500 to-purple-600 text-transparent bg-clip-text mb-4">It's a Match!</h2>
                <p class="text-gray-600 mb-6">You and <span id="matchName" class="font-bold"></span> liked each other.</p>
                <div class="flex justify-center items-center space-x-[-20px] mb-8">
                    <img id="matchUserAvatar" src="https://placehold.co/100x100/c7d2fe/312e81?text=Me" class="w-28 h-28 rounded-full border-4 border-white shadow-md object-cover" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='https://placehold.co/100x100/E2E8F0/4A5568?text=U';">
                    <img id="matchPartnerAvatar" src="https://placehold.co/100x100/E2E8F0/4A5568?text=P" class="w-28 h-28 rounded-full border-4 border-white shadow-md object-cover" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='https://placehold.co/100x100/E2E8F0/4A5568?text=P';">
                </div>
                <button onclick="openChatFromMatch()" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-full text-lg shadow-md hover:bg-indigo-700 transition-transform transform hover:scale-105 mb-3">
                    Send a Message
                </button>
                <button onclick="closeMatchPopup()" class="w-full bg-gray-200 text-gray-700 font-bold py-3 px-6 rounded-full hover:bg-gray-300 transition">
                    Keep Swiping
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements (cached for performance) ---
        const screens = {
            post: document.getElementById('postScreen'),
            swipe: document.getElementById('swipeScreen'),
            chatsList: document.getElementById('chatsListScreen'),
            chatView: document.getElementById('chatViewScreen'),
        };
        const dailyPromptEl = document.getElementById('dailyPrompt');
        const swipeDeck = document.getElementById('swipe-deck');
        const endOfBatchEl = document.getElementById('endOfBatch');
        const actionButtonsEl = document.getElementById('action-buttons');
        const matchPopup = document.getElementById('matchPopup');
        const matchNameEl = document.getElementById('matchName');
        const chatListContainer = document.getElementById('chatListContainer');
        const matchUserAvatar = document.getElementById('matchUserAvatar');
        const matchPartnerAvatar = document.getElementById('matchPartnerAvatar');
        const chatPartnerAvatar = document.getElementById('chatPartnerAvatar');
        const chatPartnerName = document.getElementById('chatPartnerName');
        const chatMessagesContainer = document.getElementById('chatMessages');
        const messageForm = document.getElementById('messageForm');
        const messageInput = document.getElementById('messageInput');

        // --- Mock Data ---
        const prompts = ["Your favorite study spot ðŸ“š", "What's for lunch today? ðŸ•", "Campus view from your window ðŸŒ³", "Show off your coffee order â˜•", "Your current lecture hall ðŸ§‘â€ðŸ«"];
        const users = [
            { id: 'u1', name: 'Ava', age: 20, major: 'CompSci', img: 'https://images.unsplash.com/photo-1520405230983-a213a1e3b00c?q=80&w=800&auto=format&fit=crop', promptResponse: 'Quiet corner in the library!' },
            { id: 'u2', name: 'Leo', age: 22, major: 'Engineering', img: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=800&auto=format&fit=crop', promptResponse: 'Fueling up at the cafe.' },
            { id: 'u3', name: 'Mia', age: 21, major: 'Art History', img: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=800&auto=format&fit=crop', promptResponse: 'Found some sun on the main quad.' },
            { id: 'u4', name: 'Noah', age: 19, major: 'Physics', img: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=800&auto=format&fit=crop', promptResponse: 'Lab day vibes.' },
            { id: 'u5', name: 'Chloe', age: 20, major: 'Literature', img: 'https://images.unsplash.com/photo-1580489944761-15a19d654956?q=80&w=800&auto=format&fit=crop', promptResponse: 'Reading by the campus lake.' },
            { id: 'u6', name: 'Ben', age: 23, major: 'Business', img: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=800&auto=format&fit=crop', promptResponse: 'Networking event attire.' },
            { id: 'u7', name: 'Sophie', age: 21, major: 'Psychology', img: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=800&auto=format&fit=crop', promptResponse: 'Observing campus life for a project.' },
            { id: 'u8', name: 'Jack', age: 20, major: 'Kinesiology', img: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?q=80&w=800&auto=format&fit=crop', promptResponse: 'Post-workout protein shake.' },
        ];
        let matches = [
            { id: 1, user: users[1], lastMessage: 'Hey! Saw we matched. Cool photo!', unread: 1, messages: [{ sender: 'them', text: 'Haha thanks! Your study spot looks so peaceful.' }, { sender: 'me', text: 'It\'s the only way to get work done here ðŸ˜‚' }, { sender: 'them', text: 'Hey! Saw we matched. Cool photo!' },] },
            { id: 2, user: users[4], lastMessage: 'You too! Great minds think alike.', unread: 0, messages: [{ sender: 'me', text: 'No way, we had the same lunch! ðŸ•' }, { sender: 'them', text: 'You too! Great minds think alike.' }] }
        ];

        // --- App State ---
        let currentBatch = [];
        let currentIndex = 0;
        let activeCard = null;
        let startPoint = { x: 0 };
        let currentMatch = null;
        let isDragging = false;
        let animationFrameId = null;
        let currentChatId = null;

        // --- Functions ---
        function showScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            if (screens[screenId]) {
                screens[screenId].classList.remove('hidden');
                screens[screenId].classList.add('flex');
            }
        }

        function initializeApp() {
            dailyPromptEl.textContent = prompts[Math.floor(Math.random() * prompts.length)];
            renderChatList();
            messageForm.addEventListener('submit', sendMessage);
            showScreen('post');
        }
        
        // --- Card Swiping Logic ---
        function startSwiping() {
            currentBatch = [...users].sort(() => 0.5 - Math.random());
            currentIndex = 0;
            showScreen('swipe');

            const oldStack = swipeDeck.querySelector('.swipe-card-stack');
            if (oldStack) oldStack.remove();
            
            const newStack = document.createElement('div');
            newStack.className = 'swipe-card-stack';
            swipeDeck.prepend(newStack);
            
            actionButtonsEl.style.display = 'flex';
            endOfBatchEl.classList.add('hidden');

            if (currentBatch.length === 0) {
                endOfBatchEl.classList.remove('hidden');
                actionButtonsEl.style.display = 'none';
                return;
            }

            currentBatch.forEach(user => {
                const card = createCardElement(user);
                newStack.appendChild(card);
            });
            
            addListenersToTopCard();
        }
        
        function createCardElement(user) {
            const card = document.createElement('div');
            card.className = 'swipe-card flex flex-col bg-white rounded-2xl overflow-hidden shadow-xl cursor-grab';
            card.innerHTML = `
                <div class="swipe-card-image">
                    <img src="${user.img}" class="w-full h-full object-cover" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='https://placehold.co/600x800/E2E8F0/4A5568?text=Image+Error';">
                </div>
                <div class="p-5 flex flex-col justify-between flex-grow">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800">${user.name}, ${user.age}</h3>
                        <p class="text-gray-500">${user.major}</p>
                        <div class="mt-3 border-t pt-3 text-gray-600">
                           <p>"${user.promptResponse}"</p>
                        </div>
                    </div>
                </div>
                <div class="like-nope-badge absolute top-8 right-8 text-green-400 border-4 border-green-400 rounded-xl py-2 px-4 text-4xl font-bold uppercase tracking-wider transform -rotate-10 opacity-0" data-badge="like">Like</div>
                <div class="like-nope-badge absolute top-8 left-8 text-red-500 border-4 border-red-500 rounded-xl py-2 px-4 text-4xl font-bold uppercase tracking-wider transform rotate-10 opacity-0" data-badge="nope">Nope</div>
            `;
            return card;
        }
        
        function addListenersToTopCard() {
             const topCard = swipeDeck.querySelector('.swipe-card-stack > :first-child');
             if (topCard) {
                 topCard.addEventListener('mousedown', onDragStart);
                 topCard.addEventListener('touchstart', onDragStart, { passive: true });
             }
        }

        function handleSwipe(direction) {
            const cardEl = swipeDeck.querySelector('.swipe-card-stack > :first-child');
            if (!cardEl) return;
            
            const isRightSwipe = direction === 'right';
            cardEl.style.transition = 'transform 0.4s ease-out';
            const rotation = isRightSwipe ? 20 : -20;
            const translateX = isRightSwipe ? window.innerWidth : -window.innerWidth;
            cardEl.style.transform = `translateX(${translateX}px) rotate(${rotation}deg)`;

            if (isRightSwipe && Math.random() > 0.6) { 
                currentMatch = currentBatch[currentIndex];
                setTimeout(() => showMatchPopup(currentMatch), 250);
            }
            
            setTimeout(() => {
                cardEl.remove();
                currentIndex++;
                addListenersToTopCard();
                if (swipeDeck.querySelector('.swipe-card-stack > :first-child') === null) {
                    endOfBatchEl.classList.remove('hidden');
                    actionButtonsEl.style.display = 'none';
                }
            }, 400);
        }

        function onDragStart(e) {
            if (isDragging) return;
            isDragging = true;
            activeCard = e.currentTarget;
            startPoint.x = e.pageX ?? e.touches[0].pageX;
            
            activeCard.classList.add('dragging');
            document.addEventListener('mousemove', onDragMove);
            document.addEventListener('touchmove', onDragMove, { passive: true });
            document.addEventListener('mouseup', onDragEnd);
            document.addEventListener('touchend', onDragEnd);

            animationFrameId = requestAnimationFrame(updateCardPosition);
        }

        let lastX = 0;
        function onDragMove(e) {
            if (!activeCard) return;
            lastX = e.pageX ?? e.touches[0].pageX;
        }

        function updateCardPosition() {
            if (!isDragging || !activeCard) return;

            const diffX = lastX - startPoint.x;
            const rotate = diffX / 20;

            activeCard.style.transform = `translateX(${diffX}px) rotate(${rotate}deg)`;
            
            const likeBadge = activeCard.querySelector('[data-badge="like"]');
            const nopeBadge = activeCard.querySelector('[data-badge="nope"]');
            
            const opacity = Math.min(Math.abs(diffX) / 100, 1);
            if (diffX > 0) {
                likeBadge.style.opacity = opacity;
                nopeBadge.style.opacity = 0;
            } else {
                nopeBadge.style.opacity = opacity;
                likeBadge.style.opacity = 0;
            }

            animationFrameId = requestAnimationFrame(updateCardPosition);
        }

        function onDragEnd(e) {
            if (!isDragging || !activeCard) return;
            isDragging = false;
            cancelAnimationFrame(animationFrameId);

            document.removeEventListener('mousemove', onDragMove);
            document.removeEventListener('touchmove', onDragMove);
            document.removeEventListener('mouseup', onDragEnd);
            document.removeEventListener('touchend', onDragEnd);

            const diffX = lastX - startPoint.x;
            if (Math.abs(diffX) > 100) {
                handleSwipe(diffX > 0 ? 'right' : 'left');
            } else {
                activeCard.style.transform = '';
                activeCard.querySelector('[data-badge="like"]').style.opacity = 0;
                activeCard.querySelector('[data-badge="nope"]').style.opacity = 0;
            }
            activeCard.classList.remove('dragging');
            activeCard = null;
        }

        function showMatchPopup(matchedUser) {
            matchNameEl.textContent = matchedUser.name;
            matchPartnerAvatar.src = matchedUser.img;
            matchPopup.classList.remove('hidden');
        }

        function closeMatchPopup() { matchPopup.classList.add('hidden'); }
        
        function openChatFromMatch() {
             if (currentMatch) {
                let existingMatch = matches.find(m => m.user.id === currentMatch.id);
                if (!existingMatch) {
                    const newMatch = { id: matches.length + 1, user: currentMatch, lastMessage: "You can start the conversation!", unread: 0, messages: [] };
                    matches.unshift(newMatch);
                    renderChatList();
                    existingMatch = newMatch;
                }
                openChat(existingMatch.id);
            }
            closeMatchPopup();
        }

        function renderChatList() {
            chatListContainer.innerHTML = '';
            if (matches.length === 0) {
                 chatListContainer.innerHTML = `<div class="text-center p-8 text-gray-500"><i class="ph-chat-circle-dots text-5xl"></i><p class="mt-2">Your matches will appear here.</p></div>`;
                 return;
            }
            const fragment = document.createDocumentFragment();
            matches.forEach(match => {
                const chatItem = document.createElement('div');
                chatItem.className = 'flex items-center p-4 hover:bg-gray-50 cursor-pointer border-b border-gray-100';
                chatItem.onclick = () => openChat(match.id);
                chatItem.innerHTML = `<img src="${match.user.img}" class="w-16 h-16 rounded-full mr-4 object-cover" loading="lazy" decoding="async"><div class="flex-grow"><div class="flex justify-between items-center"><h3 class="font-bold text-lg text-gray-800">${match.user.name}</h3>${match.unread > 0 ? `<span class="bg-indigo-600 text-white text-xs font-bold rounded-full px-2 py-1">${match.unread}</span>` : ''}</div><p class="text-gray-500 truncate">${match.lastMessage}</p></div>`;
                fragment.appendChild(chatItem);
            });
            chatListContainer.appendChild(fragment);
        }
        
        function openChat(matchId) {
            const match = matches.find(m => m.id === matchId);
            if (!match) return;
            
            currentChatId = matchId;
            match.unread = 0; // Mark as read
            renderChatList(); // Update the list to remove the badge

            chatPartnerName.textContent = match.user.name;
            chatPartnerAvatar.src = match.user.img;
            
            renderMessages(match);
            showScreen('chatView');
        }

        function renderMessages(match) {
            chatMessagesContainer.innerHTML = '';
            if (match.messages.length === 0) {
                chatMessagesContainer.innerHTML = `<div class="text-center text-sm text-gray-400 p-4">You matched with ${match.user.name}. Start the conversation!</div>`;
            } else {
                const fragment = document.createDocumentFragment();
                match.messages.forEach(msg => {
                    const messageEl = document.createElement('div');
                    const isMe = msg.sender === 'me';
                    messageEl.className = `flex mb-3 ${isMe ? 'justify-end' : 'justify-start'}`;
                    messageEl.innerHTML = `<div class="max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${isMe ? 'bg-indigo-600 text-white rounded-br-lg' : 'bg-white text-gray-800 rounded-bl-lg shadow-sm'}">${msg.text}</div>`;
                    fragment.appendChild(messageEl);
                });
                chatMessagesContainer.appendChild(fragment);
            }
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        }
        
        function sendMessage(e) {
            e.preventDefault();
            const text = messageInput.value.trim();
            if (text === '' || !currentChatId) return;

            const match = matches.find(m => m.id === currentChatId);
            if (!match) return;

            const newMessage = { sender: 'me', text: text };
            match.messages.push(newMessage);
            match.lastMessage = text;

            // Move the current chat to the top of the list
            matches = matches.filter(m => m.id !== currentChatId);
            matches.unshift(match);

            messageInput.value = '';
            renderMessages(match);
            renderChatList();
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>

